variables:
  CIBW_BUILD: cp3?-manylinux_x86_64
  CIBW_SKIP: "*-win32 *-macosx_x86_64"
  CIBW_MANYLINUX_X86_64_IMAGE: manylinux2014
  CIBW_DEPENDENCY_VERSIONS: latest

jobs:
  - job: Build_manylinux
    pool:
      vmImage: ubuntu-latest
    steps:
      - task: UsePythonVersion@0
      - script: python -m pip install --upgrade pip setuptools wheel cibuildwheel
        displayName: Install tools
      - script: python -m cibuildwheel --output-dir wheelhouse .
        displayName: Build wheel
      - task: PublishBuildArtifacts@1
        inputs: {pathtoPublish: 'wheelhouse'}

  - job: Build_macos
    strategy:
      matrix:
        macos-10.15-py35:
          VM_IMAGE: macos-10.15
          PYTHON_VERSION: 3.5
        macos-10.15-py36:
          VM_IMAGE: macos-10.15
          PYTHON_VERSION: 3.6
        macos-10.15-py37:
          VM_IMAGE: macos-10.15
          PYTHON_VERSION: 3.7
        macos-10.15-py38:
          VM_IMAGE: macos-10.15
          PYTHON_VERSION: 3.8
        macos-10.14-py35:
          VM_IMAGE: macos-10.14
          PYTHON_VERSION: 3.5
        macos-10.14-py36:
          VM_IMAGE: macos-10.14
          PYTHON_VERSION: 3.6
        macos-10.14-py37:
          VM_IMAGE: macos-10.14
          PYTHON_VERSION: 3.7
        macos-10.14-py38:
          VM_IMAGE: macos-10.14
          PYTHON_VERSION: 3.8
    pool:
      vmImage: '$(VM_IMAGE)'
    steps:
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '$(PYTHON_VERSION)'
      - script: python -m pip install --upgrade pip setuptools wheel
        displayName: Install tools
      - script: python -m pip wheel -w wheelhouse .
        displayName: Build wheel
      - task: PublishBuildArtifacts@1
        inputs: {pathtoPublish: 'wheelhouse'}


